<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurar - Wake on LAN</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="2" y="3" width="20" height="14" rx="2"/>
                <path d="M8 21h8"/>
                <path d="M12 17v4"/>
            </svg>
            <span>Wake on LAN</span>
        </div>
        <div class="nav-links">
            <a href="{{ url_for('index') }}">Dashboard</a>
            <a href="{{ url_for('config') }}" class="active">Configurar</a>
            <span class="user-info">{{ current_user.username }}</span>
            <a href="{{ url_for('logout') }}">Sair</a>
        </div>
    </nav>

    <main class="container">
        <h1>Configuracoes</h1>

        <!-- COMPUTADORES -->
        <section class="config-section">
            <h2>Adicionar Computador</h2>
            <form id="add-computer-form" class="form-inline">
                <div class="form-group">
                    <label for="name">Nome</label>
                    <input type="text" id="name" name="name" required placeholder="Ex: PC Principal">
                </div>
                <div class="form-group">
                    <label for="mac">Endereco MAC</label>
                    <input type="text" id="mac" name="mac" required placeholder="AA:BB:CC:DD:EE:FF">
                </div>
                <div class="form-group">
                    <label for="ip">Endereco IP</label>
                    <input type="text" id="ip" name="ip" required placeholder="192.168.1.100">
                </div>
                <button type="submit" class="btn btn-primary">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 5v14M5 12h14"/>
                    </svg>
                    Adicionar
                </button>
            </form>
        </section>

        <section class="config-section">
            <h2>Computadores Cadastrados</h2>
            {% if computers %}
            <div class="table-container">
                <table class="computers-table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>MAC</th>
                            <th>IP</th>
                            <th>Usuarios</th>
                            <th>Acoes</th>
                        </tr>
                    </thead>
                    <tbody id="computers-list">
                        {% for computer in computers %}
                        <tr data-id="{{ computer.id }}">
                            <td>
                                <input type="text" class="edit-name" value="{{ computer.name }}" disabled>
                            </td>
                            <td>
                                <input type="text" class="edit-mac" value="{{ computer.mac }}" disabled>
                            </td>
                            <td>
                                <input type="text" class="edit-ip" value="{{ computer.ip }}" disabled>
                            </td>
                            <td>
                                <button class="btn btn-small btn-secondary" onclick="openPermissions({{ computer.id }}, '{{ computer.name }}')" title="Gerenciar usuarios">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                        <circle cx="9" cy="7" r="4"/>
                                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                                    </svg>
                                </button>
                            </td>
                            <td class="actions">
                                <button class="btn btn-small btn-edit" onclick="toggleEdit(this)" title="Editar">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                    </svg>
                                </button>
                                <button class="btn btn-small btn-save" onclick="saveComputer(this)" style="display:none" title="Salvar">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M20 6L9 17l-5-5"/>
                                    </svg>
                                </button>
                                <button class="btn btn-small btn-cancel" onclick="cancelEdit(this)" style="display:none" title="Cancelar">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M18 6L6 18M6 6l12 12"/>
                                    </svg>
                                </button>
                                <button class="btn btn-small btn-delete" onclick="deleteComputer({{ computer.id }})" title="Excluir">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                    </svg>
                                </button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="empty-message">Nenhum computador cadastrado ainda.</p>
            {% endif %}
        </section>

        <!-- USUARIOS -->
        <section class="config-section">
            <h2>Adicionar Usuario</h2>
            <form id="add-user-form" class="form-inline">
                <div class="form-group">
                    <label for="new-username">Usuario</label>
                    <input type="text" id="new-username" required placeholder="nome.usuario">
                </div>
                <div class="form-group">
                    <label for="new-user-password">Senha</label>
                    <input type="password" id="new-user-password" required placeholder="Senha inicial">
                </div>
                <div class="form-group checkbox-group">
                    <label>
                        <input type="checkbox" id="new-user-admin">
                        Administrador
                    </label>
                </div>
                <button type="submit" class="btn btn-primary">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                        <circle cx="8.5" cy="7" r="4"/>
                        <path d="M20 8v6M23 11h-6"/>
                    </svg>
                    Adicionar
                </button>
            </form>
        </section>

        <section class="config-section">
            <h2>Usuarios Cadastrados</h2>
            {% if users %}
            <div class="table-container">
                <table class="computers-table">
                    <thead>
                        <tr>
                            <th>Usuario</th>
                            <th>Tipo</th>
                            <th>Acoes</th>
                        </tr>
                    </thead>
                    <tbody id="users-list">
                        {% for user in users %}
                        <tr data-id="{{ user.id }}">
                            <td>
                                <input type="text" class="edit-username" value="{{ user.username }}" disabled>
                            </td>
                            <td>
                                {% if user.is_admin %}
                                <span class="badge badge-admin">Admin</span>
                                {% else %}
                                <span class="badge badge-user">Usuario</span>
                                {% endif %}
                            </td>
                            <td class="actions">
                                <button class="btn btn-small btn-secondary" onclick="openChangePassword({{ user.id }}, '{{ user.username }}')" title="Alterar senha">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="11" width="18" height="11" rx="2"/>
                                        <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                    </svg>
                                </button>
                                {% if not user.is_admin %}
                                <button class="btn btn-small btn-delete" onclick="deleteUser({{ user.id }})" title="Excluir">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                    </svg>
                                </button>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="empty-message">Nenhum usuario cadastrado.</p>
            {% endif %}
        </section>

        <!-- MINHA SENHA -->
        <section class="config-section">
            <h2>Alterar Minha Senha</h2>
            <form id="change-password-form" class="form-inline">
                <div class="form-group">
                    <label for="current-password">Senha Atual</label>
                    <input type="password" id="current-password" required>
                </div>
                <div class="form-group">
                    <label for="new-password">Nova Senha</label>
                    <input type="password" id="new-password" required>
                </div>
                <button type="submit" class="btn btn-secondary">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                    </svg>
                    Alterar Senha
                </button>
            </form>
        </section>
    </main>

    <!-- Modal de Permissoes -->
    <div id="permissions-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Permissoes: <span id="modal-computer-name"></span></h3>
                <button class="btn-close" onclick="closeModal('permissions-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <p>Selecione os usuarios que podem ligar este computador:</p>
                <div id="users-checkboxes" class="checkbox-list"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('permissions-modal')">Cancelar</button>
                <button class="btn btn-primary" onclick="savePermissions()">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Alterar Senha de Usuario -->
    <div id="password-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Alterar Senha: <span id="modal-user-name"></span></h3>
                <button class="btn-close" onclick="closeModal('password-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="admin-new-password">Nova Senha</label>
                    <input type="password" id="admin-new-password" placeholder="Digite a nova senha">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('password-modal')">Cancelar</button>
                <button class="btn btn-primary" onclick="saveUserPassword()">Salvar</button>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        // Dados dos usuarios para o modal
        const allUsers = {{ users|tojson|safe }};
        let currentComputerId = null;
        let currentUserId = null;
    </script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
